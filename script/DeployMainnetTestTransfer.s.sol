// SPDX-License-Identifier: MIT
pragma solidity 0.8.28;

import {Script, console} from "forge-std/Script.sol";
import {QuantumAccount} from "../src/QuantumAccount.sol";
import {EntryPoint} from "../lib/account-abstraction/contracts/core/EntryPoint.sol";
import {HelperConfig} from "./HelperConfig.s.sol";
import {PackedUserOperation} from "../lib/account-abstraction/contracts/interfaces/PackedUserOperation.sol";

contract DeployTestTransfer is Script {

    bool getNonce = false;

    EntryPoint entryPoint;
    address senderAddress = 0x21e9b414891741a9778c00f5323157fb753dc28F;

    //userOpHash (nonce 1): 0xd108fa116ae1ca7774d8ce2eff1031b13789685e01d1c6052d8db94407bd1faa

    PackedUserOperation userOp = PackedUserOperation({
                    sender: address(senderAddress),
                    nonce: 0,
                    initCode: hex"",
                    callData: hex"",
                    accountGasLimits: 0x00000000000000000000000000FFFFFF00000000000000000000000000030D40,
                    preVerificationGas: 16777215,
                    gasFees: 0x0000000000000000000000003b9aca00000000000000000000000000b2d05e00,
                    paymasterAndData: hex"",
                    signature: hex"d1ef2d65f4cdec1c8db4aeb274479c2a9dffda608910fdb19e187f5e3e610b0828387fdcb56c06e0010f2f6900682f042f0300692fc6007f300000a700b92f22016b00d52f702fe200712fa500370066003f0044004e00822fee000700282ed52f6a2fb22fd52f6100332f602f0f2f9a000b0099009c2f462f9e2f042ff82f6301d800032f5d00b700472fdf2f7f00f02fb52fcc2f362fd400b300bc2f2d003f008d2fdb000b2f990012005c2ebc2fd12fed2f7b001d2fc32f9300252f9000c700920062008d00c32fd52f4b00012fd02fb700b000fc2fae2fe500592f942f0c2fc72f642ef82f9d010a2fa52f7e00302ff000e900e02fa72ece2ebd2f982fdc00ab00f82ffb2eaf007400322f9f0081007f2f4b2fae2ee42fc82fbc00512f432f952f5c005f2fb100740020010a2f972fce0012010f2ef7006100282ff1008a00bf2f6d0025003f007400ae00642fbe2f692fb5003a00bd00f02fd1004800300002004801462fdd2fd12eac2f3c2f4c2ea200e62f2100852ff52f152f9801062fde2fe82fde2f0b2fee2f702f602f702fa92f182eed005c003b005200652f332fe5007e00962f982ff52f8d2f710093011b2f552f3e005e000f2f782f6800b72f1f012200a5018900092f4f00e3002200232ff92ff22fb200c32f022f2b2ef62fa32f7000bb007b2f6d2fa92ff500382f702ff3004d008b00382fba2f222f252fe62fd3000f00de00012ff02f19006f2fc100692f942fae2eed007c2f0301c4000800582fb92fa42f0700272ff000832f5e2f6b003900242f9f00c200ea00382e9c007d2fb8003b00862fa52f3800be009b005400032f4e002d2fac011c00422f7100782f250139007000140041010e008000352fc900302fdd00d80055004b00e52f87008200dd2fba2f76016800952f302fa32ff12f342fcf2f91008f2fa6006a2f5d2f8d00280011006e00c400ea000b2fd4001a006a001e2f772ff02f840188007e2f5a2fe42fc52ff4005b2fea003b00f1000700ac00102fd22f812fc100b82ef600622f8900082f7e2f522fa52fb02fee013000b52f212f602f7e2ffb2f7a2fbc2fc000ed003b2fa90100000f2fa12efb0029006e00942f812fc22ff7000a2fc22f2d006500182fcd2f692fc8002a00902f252f4a2f752fcd016c00062fa52f122e7a2f5f000200542f712fdc2fe300c201e02fba2fd72fa9002a009000422fd72fc72fdf2fa900d72fef00cf00342fd0008100012fc10173000b2ffb2f942fa3009f00462fb60096010b01542f352fa100222eef001b00332f6c2fac00582ed92ff12f982f9c004b2fc42ffb2fda2f4d2feb2fa40026007f2f122ea52f9c01772ff52fc300482f90000b2fdb2fd62fb200672f912f65003601202fe32f572fcc2fcb2fd02f1c00132f3e2fa72e812fdf2eab2f4d002f00ee00102efe00412f312f582fdc2f8c007a2fba2fc2017e2eff00cb010e006f2ffc2f2500a62f8900802f342f812fb42f2f2fe000262f4e2fc3007e00982ef6000b2fa02fc5004100402ea02fb72f452e072f422f5301280102009d00802f0e004d2fe42f482ff22f632faa011800762f992fca2fb90074004000a42f692fa900012f2c2f7201052ee82fe90009004c00742f402f7e00042fdf2f262fe92fa22faf00d92fe800a00076004a00332e3600952fea011c2fb52f9d000000f7007b2f8700ad004700412ff20019004901292fb500e5000d013300062f892fea2f7e008d2fdc2fd5003900b82f8c009500492f8800342fa52f2200a5004a2fad2fd4000500792fd82fa200ff2eed005500192f7d2ef12f0400612f3501042eeb2f85003c0096008600122ece005b007e018701f52fd22f14002900142ed500952f6a00632fff01322ee9001a2f6b00a42fd6010d017c2f58001d004b00392ff82fd22f32002a2fdd00d600362f070089000400652f2d00fb2ee900192fda2ff22fed00fc2ed12f3a00710027003b005f001500dc007c00ce012200992fd22f93002e003e2ecc2fb72fec00c400d92f8b013b2fca007100382f4f001d2e96018c2f8e2ff62ff32f9300792fe6009b2efa2eb62f142f8a2fc62faf00f200502f5a2f902fd82ef4004c2f162fea01012fd82ff12f982fc301062ef72fa0004800942fb12f2b2fba2ef22fce00252fa02fac2fef2f3d2f52002300942fd22f41008b2f6a2f06018d2fe1003b00332f7a0107008b2ebf001c2fdb0058000300302e55000900232f2d2fc5006f2ef902160014004f00432f9c00b22fee2fab0001003c2fb900a82ffa005b01042fcb2ec62fcf002901d600062fdc000b2e412f932fe600972fb8005e00502f422f5e0031004c00522f092f35000d2fb12fae00cb2e842f4c019c2fcc2f5f00942f54007c2e392f432f2501832f242ed7007901232fd52fac2fa2002600202fdb00be2fc92e43009700aa2f882f8f00392f402fe7011e2f7d2f6d2fa000f62fb6005800602f82006900c82fd400022fad2f51015d2f6f2f0f2f942f7a00562ea100982fd4007f00402f932eef000a00452f232fa600f92fcb2f432ff701312f9c2f8b000d2f4000532fc801202f6a00132fa6011d000700452e9e2fbd01ba0056010500602fe000aa00212fc52f0e2ff8003c2fab2f002f7b019f2fdd006a00242ff701352f2e00112ff801142fc02f82016000c101110033003000f600252f74003d2f5c002f2fc32fcf0042003b2f60004300802f792f42001c2f942e9c00da2fb5009f00182f5b00e700d00077003c2f1d00330043006a00862eee008f005a2f612fc100762fdd2f9d2f76007b2fdf00362ff80084004f2fba2f982fe600112fd100a82e562f8300032ecf00f500d0015700d70096002c2f50010b00312f6f004a2f7f003f00212f0c2f872fe72f8d01302fdb2faa2eae2fe42fdc00f0006200b02f4100d7"
    });
    function run()
        external
    {
        require(block.chainid == 1, "Only Mainnet network is supported for this script");
        bytes memory callData = abi.encodeWithSelector(
            bytes4(0xb61d27f6),                       // execute(address,uint256,bytes)
            address(0x78dFD9B2170b8A1b4C7B103BE8a5498858B39914),
            0.1 ether,
            bytes("")                                 // or the real calldata for dest
        );
        userOp.callData = callData;
        uint maxFeePerGas = 0.955 gwei;
        uint maxPriorityFeePerGas = 0.045 gwei;
        uint gasFees = (maxPriorityFeePerGas << 128) | maxFeePerGas;
        userOp.gasFees = bytes32(gasFees);
        HelperConfig helperConfig = new HelperConfig();
        entryPoint = helperConfig.getNetworkConfig().entryPoint;
        
        PackedUserOperation[] memory userOperationArray = new PackedUserOperation[](1);
        userOperationArray[0] = userOp;

        vm.startBroadcast();
        if (getNonce) {
            uint256 nonce = QuantumAccount(payable(senderAddress)).getNonce();
            console.log("QuantumAccount Nonce: ", nonce);
        } else {
            entryPoint.handleOps(userOperationArray, payable(msg.sender));
        }
        vm.stopBroadcast();

    }
}