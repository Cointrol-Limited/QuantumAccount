// SPDX-License-Identifier: MIT
pragma solidity 0.8.28;

import {Script, console} from "forge-std/Script.sol";
import {QuantumAccount} from "../src/QuantumAccount.sol";
import {EntryPoint} from "../lib/account-abstraction/contracts/core/EntryPoint.sol";
import {HelperConfig} from "./HelperConfig.s.sol";
import {PackedUserOperation} from "../lib/account-abstraction/contracts/interfaces/PackedUserOperation.sol";

contract DeployTestTransfer is Script {

    bool getNonce = false;

    EntryPoint entryPoint;
    address senderAddress = 0xC1C72BEA860b1F85F08CbAaFFfcd59F13A8Ea72a;

    //userOpHash (nonce 1): 0xd108fa116ae1ca7774d8ce2eff1031b13789685e01d1c6052d8db94407bd1faa

    PackedUserOperation userOp = PackedUserOperation({
                    sender: address(senderAddress),
                    nonce: 1,
                    initCode: hex"",
                    callData: hex"",
                    accountGasLimits: 0x00000000000000000000000000FFFFFF00000000000000000000000000030D40,
                    preVerificationGas: 16777215,
                    gasFees: 0x0000000000000000000000003b9aca00000000000000000000000000b2d05e00,
                    paymasterAndData: hex"",
                    signature: hex"d9eecfb803b46fc633c78d580cf53b6fafe7160269298d24ebfd70e2689ba845784d15c8a3bf096c002f00bd2ecf00072e4f2f3e004700ab00ff002d003d2f8f002c00472f0000222f2e00492f5f0093013300c000d22fa3005f2f012fc62f482fd22fad2fb100be2fde00d82fce2fd1006001362e9d2f61006f00df2f9f2f7d007000d52f34007b010600012f4e00822fb6009900af2f622f122ea7006a00312ffd007d2fbe003e00d700d92ff90052002e2fdf012e2f95008b005f00f22fb2000b2f9d2f3c2f0c2f522ff500aa00bd2fbb2fe4000b2ff500d7005f2fba2f3a012500e900042f8b2f1b2ee3003d008800ac2ff6002a2fdd2f4a006a00292fe1006e0193002200f02ec8000500502fa70075003f00772eb20001000700bb009d00922fc10075005f2fcb001d0042011c00d3002e00a500742f0400302ef72f592f9f2f252f2e2ffd2f5c2ef42f7000cd2f44003f2f7f2f992fbb2fc42f7e00b12e762fa500c900e92f4b00b7008e0090002c003900b82fcb0014003a009301202f1d01112f0900a5006d2f852f22002c2fa7010200d600372fa500230008000e00312fc1000c01882fd8001f2ffc2f47008c2fc2007f0168008e004d2f2a2f622f8e00102f9e2f13005e00460133009a003a004a2fb62f4b019e2ffe2fda2f0b004b00452ef30013003c2f852fce00392e62002b2fb1005b00890179002f2f502fa02f7801402fa42f542f952f6200e82feb2fff00382fdc2fef2fa12f5e00932f392e8001e500f300cb2f752fae2fdf00332f11011e2f452f802fa62efd2f8d005200192fbf2ee22e662fcb00c62e95012b2f21012600500102004d00b92fe70074002400a000172fd5006401352f252fde2eff2ff72f9a01cd2f83007f00692fe300042f612fcc2ed2000d007a2f9f2fc500172f122fc72fcc00432e5b002a2f482f7b01bb001800152ff22f962fd82f7d2fbb2fba2f292f9e2fac006c2eea2fce2f4b00e0002a004c2f83003a00bd000500fc2f7400222f9500662fcd00642fee2fc50038008f01ff2fb800812fa5000300d72eb12f63005f2f90008a2ff70156004400a52ef92fca002600812fdd2f2600742fa12f172f0b2fff2f78003300740055003f004d2f892f3a2f8f00e52f872ff600ba001700232fc42f8e008000a02f15007f2f55002700562f7c2eff2e9d2fae00432ff32f77002d00892fd12fc5020e2fed2fc62f8800a501042f1b2fb0000b2f9f0024001e00412fea2f5800fc018200042eb02fdb009c0079004a004e2f312ffa2ee80018003d00b92ee32f9900222f94008500092fe000352ff42ee8002f2ff300812fd0001f01160053003700332fb12fbe2ef6005f0149003b2f3500362fb800f72f9900362f6a2fd02fd82fe52f7d003200132f6300182f7200262fea2f732fb12fcc2fa72ff0009f2f8b2fd12eb90021001d2f4c00622fdd2f9400ae00582ef02f372fec00df0007016a2fea004a2f3300cd2fb5012f2f6f2f79001b00282f06002600e800022ea82ff82f9201492f7b2ff2005a00b3010a2fd92f252fda2fb4013c2fc2001d002201292f642f622f5a2f712fba01d500a301c000392ff30080003f2ea02eb82f942f302f402fff015e006a2fa62fb000690000009b2fef007c2fe0003900f40006000a005f0002006000142fbb00be2f9a00c0001700912fa9005500de2f7200e800612fb72f4f003c015e2f612f6a0053000200972fac00d501282fd4000d2f9f2f952fd72f3c01032fe0007000b700ac2f312ef1019d0041005200002f292f6e2fc2004300d72fb62ff32f5e2fb901492f792fd500ed2f6c007c2fd2006c2f5d002c01042fd600fa2f25004c00082f66000e2fc52ff900352fec00492f7900402fc8002000362fe1002a2f682ee92e87008b2fdd00ab2fc72fcf2f972fcc00ae2eea003c00872fba0036002e00862edc008f2f1300c52fb72f8a2fa92f2b2f5000e4007500c700152fec00242fb10003001e00c92fad2f592f252fe02fbd014b2f3c01082f03004a2f970014002e004a00802fe400fc00482ff101152fd22fed00322db82fda008c015e2f9a000c002a01782fb52f4700500014005400f12f612ff02ffb010f001500122fe0010d2f0200122f9001212f8c2fdd0064002a2fdf0067003e2fe200072f8700932f742f772fc90014001f2ec500402f792fec014100dc00af016b2f7c2f7600142fbd004100b8004e002200e32f3b00302ff92fa72f2901382f4600122fa800ea00ea2fcc009f2fe400c0001f016f2fa800272fc300dd2ede2f9d2fa700aa00bb008e00322f5100a72fc100832f8b2f262f36002a012d009e2ea02f952f4e2fc22ed7003e015a2e8300a9002000952fa02f7300192fc1003d014f2f53010700702f8200452f972fe900172f06000b01292f7e00a500712fb1009d002b2ebe2fea01292fec2f0c00f400712f5a00682e942fc100ef2fa400da003f00e1004a2f9500900039009800a1000c2f892ecf006e2f050025006f2fdd2f3c00302f9d00182fe9003100eb00682e91009900b02f2b00802f9c2fa100902fb62f922f9d0007009800402f9e2f8f2fef00e800a12f85004a2f622f3701a1007a2f87008b017600ad00652ee12fbb2fec00952e90006500b600aa2f4f2f63007a00522feb00a50033002a2efc2e5a011300fb009a000e2fa100972f712ee9008f003f003e012b2fc22f602eef00c100cc007000822f9f00402fe12fa22f5b0094003c2f802f7c2ee22f66004e00ab2fce003d00922eef00890000012630002f1a2fed00352ff12e4300572fa300a32fb12f102db42e972fde017001790038009d00f32f7c006600a02ee601aa0066002900b000f42f5d011b0007000b014c00c400ce006c2f98003100d92ef6012f00522f5100f500a52fb4005a01402fb700232fe8"
    });
    function run()
        external
    {
        require(block.chainid == 11155111, "Only Sepolia network is supported for this script");
        bytes memory callData = abi.encodeWithSelector(
            bytes4(0xb61d27f6),                       // execute(address,uint256,bytes)
            address(0x78dFD9B2170b8A1b4C7B103BE8a5498858B39914),
            0.1 ether,
            bytes("")                                 // or the real calldata for dest
        );
        userOp.callData = callData;
        HelperConfig helperConfig = new HelperConfig();
        entryPoint = helperConfig.getNetworkConfig().entryPoint;
        
        PackedUserOperation[] memory userOperationArray = new PackedUserOperation[](1);
        userOperationArray[0] = userOp;

        vm.startBroadcast();
        if (getNonce) {
            uint256 nonce = QuantumAccount(payable(senderAddress)).getNonce();
            console.log("QuantumAccount Nonce: ", nonce);
        } else {
            entryPoint.handleOps(userOperationArray, payable(msg.sender));
        }
        vm.stopBroadcast();

    }
}